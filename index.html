<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Satpam 2026</title>
    <!-- Framework & Library -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background: #f0f9ff; transition: background 0.3s; }
        .custom-scroll::-webkit-scrollbar { height: 8px; width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }
        .schedule-table th, .schedule-table td { border: 1px solid #cbd5e1; }
        
        /* ========== TOAST NOTIFICATIONS ========== */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; max-width: 400px; }
        .toast { padding: 16px 20px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px; animation: slideInRight 0.3s ease-out; font-size: 14px; font-weight: 500; backdrop-filter: blur(10px); }
        .toast.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .toast.error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .toast.info { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
        .toast.warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .toast-icon { font-size: 20px; flex-shrink: 0; }
        .toast-close { margin-left: auto; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; font-size: 18px; }
        .toast-close:hover { opacity: 1; }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }
        .toast.removing { animation: slideOutRight 0.3s ease-in forwards; }
        
        /* ========== LOADING OVERLAY ========== */
        .loading-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 9998; display: flex; align-items: center; justify-content: center; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: white; margin-top: 16px; font-size: 16px; font-weight: 500; }
        
        /* ========== INPUT VALIDATION ========== */
        .input-error { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        .input-success { border-color: #10b981 !important; background-color: #f0fdf4 !important; }
        .error-message { color: #dc2626; font-size: 11px; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
        
        /* ========== MOBILE SWIPE INDICATOR ========== */
        .swipe-indicator { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 25px; font-size: 13px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 9999; }
        .swipe-indicator.show { opacity: 1; }
        
        /* FIX MOBILE: Sticky non-aktif di HP */
        .sticky-col { position: relative; z-index: 1; border-right: 1px solid #cbd5e1; }
        @media (min-width: 768px) {
            .sticky-col { position: sticky; z-index: 10; border-right: 2px solid #cbd5e1 !important; }
        }

        /* --- PDF MODE (VIBRANT STYLE) --- */
        .pdf-mode .print-container { 
            max-width: none !important; width: fit-content !important; min-width: 100% !important;
            box-shadow: none !important; border: none !important;
        }

        /* 1. TABLE LAYOUT */
        .pdf-mode .schedule-table { width: 100% !important; border-collapse: collapse !important; }
        .pdf-mode th, .pdf-mode td { 
            font-size: 8.5pt !important; 
            padding: 2px 2px !important; 
            white-space: nowrap; 
            border: 0.5px solid #000 !important;
            line-height: 1.1 !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        /* 2. COLOR BOOSTING */
        .pdf-mode thead tr:first-child { 
            background-color: #1d4ed8 !important;
            color: white !important; 
            -webkit-print-color-adjust: exact !important;
        }
        
        .pdf-mode thead tr:nth-child(2) th { 
            background-color: #e5e7eb !important;
            color: #000 !important;
            -webkit-print-color-adjust: exact !important;
        }

        .pdf-mode .bg-red-100, .pdf-mode .bg-red-500 { 
            background-color: #ff9999 !important; 
            color: #000 !important; font-weight: bold !important;
        }
        
        .pdf-mode .bg-orange-100, .pdf-mode .bg-yellow-100 { 
            background-color: #ffd700 !important;
            color: #000 !important; font-weight: bold !important;
        }

        .pdf-mode .bg-blue-100, .pdf-mode .bg-indigo-100 { 
            background-color: #66b2ff !important; 
            color: #000 !important; font-weight: bold !important;
        }

        .pdf-mode .bg-emerald-100 { 
            background-color: #66ff66 !important; 
            color: #000 !important; font-weight: bold !important;
        }

        /* 3. HEADER & FOOTER */
        .pdf-mode .header-section { padding: 5px 0 10px 0 !important; border-bottom: 2px double #000 !important; text-align: center; }
        .pdf-mode h1 { font-size: 16pt !important; margin-bottom: 0 !important; color: #000 !important; }
        .pdf-mode h2 { font-size: 11pt !important; margin-bottom: 5px !important; color: #000 !important; }
        .pdf-mode .period-box { border: 1px solid #000 !important; padding: 2px 10px !important; margin-top: 5px !important; background: transparent !important; }

        .pdf-mode .footer-section { padding: 5px 0 0 0 !important; border-top: none !important; }
        .pdf-mode .legend-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .pdf-mode .legend-box { padding: 5px !important; border: 0.5px solid #000 !important; background: transparent !important; }
        
        .pdf-mode .signature-section { padding: 0 !important; margin-top: 10px !important; page-break-inside: avoid !important; }
        .pdf-mode .sig-space { margin-bottom: 35px !important; } 
        .pdf-mode .sig-text { font-size: 9pt !important; color: #000 !important; }

        .pdf-mode .sticky-col { position: static !important; border: 0.5px solid #000 !important; } 
        .pdf-mode #tableContainer { overflow: visible !important; } 
        .pdf-mode .no-print-pdf { display: none !important; }

        /* UI Styles Normal (Web) */
        .editable-input { width: 100%; background: #fff; border: 1px solid #94a3b8; padding: 2px 4px; font-weight: bold; border-radius: 4px; font-size: 11px; }
        .cell-selector { background: transparent; font-size: 9px; font-weight: bold; width: 100%; height: 100%; cursor: pointer; border: none; text-align: center; appearance: none; -webkit-appearance: none; }
        .holiday-date { background-color: #fee2e2 !important; color: #b91c1c !important; }

        /* Status Indicator */
        .sync-status { font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 99px; transition: all 0.3s; }
        .status-idle { background: #e2e8f0; color: #64748b; }
        .status-loading { background: #fef08a; color: #854d0e; }
        .status-success { background: #dcfce7; color: #166534; }
        .status-error { background: #fee2e2; color: #991b1b; }
        .status-public { background: #dbeafe; color: #1e40af; }

        @media print {
            @page { size: A3 landscape; margin: 10mm; }
            body { background: white; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="p-2 md:p-6 text-slate-800">

    <!-- ========== TOAST CONTAINER ========== -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- ========== LOADING OVERLAY ========== -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Memuat data...</div>
        </div>
    </div>
    
    <!-- ========== SWIPE INDICATOR ========== -->
    <div id="swipeIndicator" class="swipe-indicator">
        <i class="fas fa-arrows-alt-h"></i> Geser untuk ganti bulan
    </div>

    <!-- CONTROL PANEL -->
    <div class="max-w-[1400px] mx-auto mb-4 bg-white p-4 rounded-xl shadow-lg border-t-4 border-slate-600 flex flex-col gap-4 no-print">
        <div class="flex flex-wrap gap-4 justify-between items-center border-b border-slate-100 pb-4">
            <div class="flex items-center gap-4">
                <div class="bg-slate-700 text-white p-3 rounded-lg shadow-lg"><i class="fas fa-calendar-alt fa-lg"></i></div>
                <div>
                    <h1 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Sistem Penjadwalan Terpadu</h1>
                    <div class="flex items-center">
                        <select id="monthSelector" onchange="renderSchedule()" class="border-none bg-transparent font-bold text-xl outline-none cursor-pointer text-slate-800 p-0 mr-2">
                            <!-- Options via JS -->
                        </select>
                        <span class="text-xl font-bold text-slate-700">2026</span>
                    </div>
                    <div id="syncStatus" class="sync-status status-idle inline-block mt-1">
                        <i class="fas fa-circle text-[6px] mr-1"></i> Memuat Data...
                    </div>
                </div>
            </div>

            <div class="flex gap-2 flex-wrap items-center justify-end">
                <button onclick="showGithubModal()" class="px-4 py-2 bg-gray-800 hover:bg-black text-white rounded shadow text-xs font-bold transition-all flex items-center gap-2 hidden" id="btnSetupCloud">
                    <i class="fas fa-key"></i> <span>Admin Login</span>
                </button>
                 <button onclick="reloadData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded shadow text-xs font-bold transition-all flex items-center gap-2">
                    <i class="fas fa-sync-alt"></i> <span>Refresh</span>
                </button>
                <button onclick="toggleEditMode()" id="btnEdit" class="hidden px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded shadow text-xs font-bold transition-all flex items-center gap-2">
                    <i class="fas fa-edit"></i> <span id="btnEditText">Edit Manual</span>
                </button>
                
                <button onclick="shareToWhatsApp()" id="btnShareWA" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded shadow text-xs font-bold transition-all flex items-center gap-2">
                    <i class="fab fa-whatsapp text-lg"></i> <span>Share WA</span>
                </button>

                <button onclick="downloadPDF()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded shadow text-xs font-bold transition-all flex items-center gap-2">
                    <i class="fas fa-file-pdf"></i> <span>Download PDF</span>
                </button>
            </div>
        </div>

        <!-- ADMIN PANEL -->
        <div id="adminPanel" class="hidden bg-slate-50 p-4 rounded-lg border border-slate-200 border-l-4 border-l-slate-500 transition-all duration-300">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-xs font-bold text-slate-900 uppercase"><i class="fas fa-user-cog mr-2"></i>Manajemen Personil (Admin Mode)</h3>
                <div class="flex gap-2">
                    <button onclick="forcePushToGithub()" class="text-[10px] bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">Force Push Cloud</button>
                    <button onclick="logoutAdmin()" class="text-[10px] text-red-500 hover:underline">Logout Admin</button>
                </div>
            </div>
            <div class="flex flex-wrap items-end gap-2">
                <div class="flex-1 min-w-[150px]">
                    <input type="text" id="newMemberName" placeholder="NAMA..." class="w-full border border-slate-300 p-2 rounded text-xs uppercase font-bold">
                </div>
                <select id="newMemberRegu" class="w-32 border border-slate-300 p-2 rounded text-xs bg-white cursor-pointer">
                    <option value="0">PIMPINAN</option>
                    <option value="1">REGU I</option>
                    <option value="2">REGU II</option>
                    <option value="3">REGU III</option>
                </select>
                <select id="newMemberRole" class="w-32 border border-slate-300 p-2 rounded text-xs bg-white cursor-pointer">
                    <option value="Anggota">Anggota</option>
                    <option value="DANRU">DANRU</option>
                    <option value="WAKIL KOMANDAN">WAKIL</option>
                    <option value="KOMANDAN">KOMANDAN</option>
                </select>
                <button onclick="addNewMember()" class="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded text-xs font-bold">
                    + Tambah
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN SCHEDULE -->
    <div id="contentToPrint" class="print-container max-w-[1400px] mx-auto bg-white shadow-xl border border-slate-300 rounded-lg overflow-hidden" style="page-break-inside: avoid;">
        
        <!-- HEADER SECTION -->
        <div class="header-section p-6 border-b-2 border-slate-800 text-center bg-white relative">
            <div class="absolute top-2 right-2 border border-blue-200 bg-blue-50 text-blue-700 px-2 py-1 rounded text-[8px] font-bold uppercase tracking-wider hidden md:block no-print-pdf">
                <i class="fab fa-github"></i> Cloud Active
            </div>
            <h1 class="text-3xl font-bold uppercase tracking-[0.2em] text-slate-900 mb-2">Daftar Piket Penjagaan Satpam</h1>
            <h2 class="text-xl font-bold uppercase text-slate-600 mb-6">BPK Perwakilan Provinsi Aceh</h2>
            <div class="period-box inline-block border-y-2 border-slate-300 px-12 py-2 bg-slate-50">
                <p class="period-text text-sm font-bold uppercase text-slate-700">Periode: <span id="periodLabel" class="text-slate-900">Januari 2026</span></p>
            </div>
        </div>

        <div class="overflow-x-auto custom-scroll" id="tableContainer">
            <table class="w-full text-left border-collapse schedule-table min-w-[1200px]">
                <thead>
                    <tr class="bg-blue-600 text-white text-[10px] uppercase tracking-wider">
                        <th class="p-1 w-8 text-center border-blue-400">No</th>
                        <th class="p-1 w-32 sticky-col bg-blue-600 left-0 z-10 border-r border-blue-400">Jabatan</th>
                        <th class="p-1 w-40 sticky-col bg-blue-600 left-[128px] z-10 border-r border-blue-400 shadow-xl">Nama Petugas</th>
                    </tr>
                    <tr class="bg-blue-50 text-slate-800 text-[9px] text-center font-bold uppercase" id="daysRow">
                        <th colspan="3" class="bg-blue-100 sticky-col left-0 z-10 border-r border-slate-300">HARI</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody" class="text-[10px] font-medium text-slate-700 bg-white"></tbody>
            </table>
        </div>

        <!-- FOOTER SECTION -->
        <div class="footer-section bg-white border-t-2 border-slate-800">
            <div class="legend-container p-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-[10px] border-b border-slate-200">
                <div class="legend-box border border-slate-300 p-2 rounded bg-slate-50">
                    <h3 class="font-bold underline mb-2 text-slate-900">KODE JADWAL:</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <div><span class="inline-block w-2 h-2 bg-orange-500 rounded-full mr-1"></span><b>K:</b> Kantor</div>
                        <div><span class="inline-block w-2 h-2 bg-emerald-500 rounded-full mr-1"></span><b>B:</b> Batoh</div>
                        <div><span class="inline-block w-2 h-2 bg-indigo-500 rounded-full mr-1"></span><b>S:</b> Stui</div>
                        <div class="text-red-600"><span class="inline-block w-2 h-2 bg-red-500 rounded-full mr-1"></span><b>L:</b> Libur</div>
                    </div>
                </div>
                <div class="legend-box border border-slate-300 p-2 rounded bg-slate-50">
                    <h3 class="font-bold underline mb-2 text-slate-900">CATATAN:</h3>
                    <ul class="list-disc pl-4 space-y-1">
                        <li>Pimpinan Libur Bergantian saat Tanggal Merah.</li>
                        <li>Jadwal diupdate secara real-time.</li>
                        <li><b>Data Libur:</b> Estimasi kalender nasional & hijriyah.</li>
                    </ul>
                </div>
            </div>

            <div class="signature-section p-6 pb-8 grid grid-cols-2 gap-8 text-[11px] text-slate-900" style="page-break-inside: avoid;">
                <div class="flex flex-col items-center text-center">
                    <p class="sig-text mb-1">Mengetahui,</p>
                    <p class="sig-text font-bold uppercase mb-16 sig-space">Kasubbag Umum & TI</p>
                    <p class="sig-text font-bold underline uppercase tracking-wide">Wirahman Salvana</p>
                    <p class="sig-text text-[10px] text-slate-500">NIP. 199301142018011002</p>
                </div>
                <div class="flex flex-col items-center text-center">
                    <p class="sig-text mb-1">Banda Aceh, <span id="signDate">...... Januari 2026</span></p>
                    <p class="sig-text font-bold uppercase mb-16 sig-space">Komandan Satpam</p>
                    <p class="sig-text font-bold underline uppercase tracking-wide">Juhadi</p>
                </div>
            </div>
        </div>
    </div>

    <!-- GITHUB SETTINGS MODAL -->
    <div id="githubModal" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md overflow-hidden border border-slate-600">
            <div class="bg-slate-800 p-4 flex justify-between items-center text-white">
                <h3 class="font-bold text-sm uppercase"><i class="fab fa-github mr-2"></i>Login Admin Cloud</h3>
                <button onclick="document.getElementById('githubModal').classList.add('hidden')" class="hover:text-red-300 text-xl">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <p class="text-xs text-slate-500 bg-slate-100 p-2 rounded">
                    Masukkan Token GitHub untuk mengaktifkan Mode Edit.
                </p>
                <div>
                    <label class="block text-xs font-bold text-slate-700 mb-1">GitHub Username</label>
                    <input type="text" id="ghUsername" class="w-full border p-2 rounded text-xs">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-700 mb-1">Repository Name</label>
                    <input type="text" id="ghRepo" class="w-full border p-2 rounded text-xs">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-700 mb-1">Personal Access Token</label>
                    <input type="password" id="ghToken" class="w-full border p-2 rounded text-xs">
                </div>
                <button onclick="saveGithubConfig()" class="w-full bg-slate-800 hover:bg-black text-white py-2 rounded text-xs font-bold">
                    LOGIN ADMIN
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== TOAST NOTIFICATION SYSTEM ====================
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas ${icons[type]} toast-icon"></i>
                <div style="flex: 1;">${message}</div>
                <i class="fas fa-times toast-close"></i>
            `;
            
            container.appendChild(toast);
            
            toast.querySelector('.toast-close').onclick = () => removeToast(toast);
            setTimeout(() => removeToast(toast), duration);
        }
        
        function removeToast(toast) {
            toast.classList.add('removing');
            setTimeout(() => toast.remove(), 300);
        }
        
        // ==================== LOADING OVERLAY ====================
        function showLoading(text = 'Memuat data...') {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingText').textContent = text;
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // ==================== INPUT VALIDATION ====================
        function validateInput(input, rules) {
            const value = input.value.trim();
            let isValid = true;
            let errorMsg = '';
            
            input.classList.remove('input-error', 'input-success');
            const prevError = input.parentElement.querySelector('.error-message');
            if (prevError) prevError.remove();
            
            if (rules.required && !value) {
                isValid = false;
                errorMsg = 'Field ini wajib diisi';
            } else if (rules.minLength && value.length < rules.minLength) {
                isValid = false;
                errorMsg = `Minimal ${rules.minLength} karakter`;
            } else if (rules.pattern && !rules.pattern.test(value)) {
                isValid = false;
                errorMsg = rules.patternMessage || 'Format tidak valid';
            }
            
            if (!isValid) {
                input.classList.add('input-error');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${errorMsg}`;
                input.parentElement.appendChild(errorDiv);
            } else if (value) {
                input.classList.add('input-success');
            }
            
            return isValid;
        }
        
        // ==================== MOBILE SWIPE GESTURES ====================
        let touchStartX = 0;
        let touchStartY = 0;
        let isSwiping = false;
        
        function initSwipeGestures() {
            const table = document.getElementById('tableContainer');
            
            table.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                isSwiping = false;
            }, { passive: true });
            
            table.addEventListener('touchmove', (e) => {
                if (!touchStartX) return;
                
                const diffX = e.touches[0].clientX - touchStartX;
                const diffY = e.touches[0].clientY - touchStartY;
                
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    isSwiping = true;
                }
            }, { passive: true });
            
            table.addEventListener('touchend', (e) => {
                if (!isSwiping) return;
                
                const diffX = e.changedTouches[0].clientX - touchStartX;
                
                if (Math.abs(diffX) > 100) {
                    const indicator = document.getElementById('swipeIndicator');
                    
                    if (diffX > 0) {
                        changeMonth(-1);
                        indicator.innerHTML = '<i class="fas fa-arrow-left"></i> Bulan Sebelumnya';
                    } else {
                        changeMonth(1);
                        indicator.innerHTML = '<i class="fas fa-arrow-right"></i> Bulan Berikutnya';
                    }
                    
                    indicator.classList.add('show');
                    setTimeout(() => indicator.classList.remove('show'), 1500);
                }
                
                touchStartX = 0;
                touchStart
